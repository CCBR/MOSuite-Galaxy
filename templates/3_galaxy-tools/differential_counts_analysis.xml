<?xml version="1.0" ?>
<tool id="mosuite_diff_counts" name="Differential Counts Analysis" version="v0.2.1" profile="24.2">
    <description>Differential expression analysis</description>
    <requirements>
        <container type="docker">nciccbr/mosuite:v0.2.1</container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
echo 'galaxy_params.json' &&
cat 'galaxy_params.json' &&
echo '' &&
python '$__tool_directory__/format_values.py' 'galaxy_params.json' 'cleaned_params.json'
    --bool-values input_in_log_counts return_mean_and_sd save_plots
    --list-values contrasts samples_to_include contrast_colname covariates_colnames &&
echo 'cleaned_params.json' &&
cat 'cleaned_params.json' &&
echo '' &&
mosuite diff_counts --json=cleaned_params.json
]]></command>
    <configfiles>
        <inputs name="params_json" filename="galaxy_params.json" data_style="paths"/>
    </configfiles>
    <inputs>
        <param name="moo_input_rds" type="data" format="binary" label="MOO input Rds" help="File path to read the input multiOmicDataSet object (MOO)"/>
        <section name="basic" title="basic" expanded="false">
            <param name="moo_output_rds" type="text" label="MOO output Rds" value="moo.rds" help="File path to output the multiOmicDataSet object (MOO) as an Rds file at the end of the function"/>
        </section>
        <section name="basic" title="Basic" expanded="false">
            <param name="count_type" type="text" label="Count Type" value="filt" help="the type of counts to use -- must be a name in the counts slot (`moo@counts`)
"/>
            <param name="sub_count_type" type="text" label="Sub Count Type" value="" help="if `count_type` is a list, specify the sub count type within the list. (Default: `NULL`)
"/>
            <repeat name="contrasts_repeat" title="Contrasts">
                <param name="value" type="text" label="Value" help="Specify each contrast in the format group1-group2, e.g. treated-control
"/>
            </repeat>
            <param name="feature_id_colname" type="text" label="Feature/Gene Names Column" help="The column from the counts data containing the Feature IDs (Usually Gene or Protein ID).
This is usually the first column of your input Counts Matrix. Only columns of Text type from your input Counts
Matrix will be available to select for this parameter. (Default: `NULL` - first column in the counts matrix will be
used.)
"/>
            <param name="sample_id_colname" type="text" label="Sample Names Column" help="The column from the sample metadata containing the sample names. The names in this column
must exactly match the names used as the sample column names of your input Counts Matrix. (Default: `NULL` - first
column in the sample metadata will be used.)
"/>
            <repeat name="samples_to_include_repeat" title="Columns to Include">
                <param name="value" type="text" label="Value" help="Which samples would you like to include? Usually, you will choose all sample columns, or
you could choose to remove certain samples. Samples excluded here will be removed in this step and from further
analysis downstream of this step. (Default: `NULL` - all sample IDs in `moo@sample_meta` will be used.)
"/>
            </repeat>
            <repeat name="contrast_colname_repeat" title="Contrast Variable Column">
                <param name="value" type="text" label="Value" help="The column in the metadata that contains the group variables you wish to find differential
expression between. Up to 2 columns (2-factor analysis) can be used.
"/>
            </repeat>
            <repeat name="covariates_colnames_repeat" title="Covariates Column(s)">
                <param name="value" type="text" label="Value" help="Columns to be used as covariates in linear modeling. Must include column from &quot;Contrast
Variable&quot;. Most commonly your covariate will be group and batch (if you have different batches in your data).
"/>
            </repeat>
        </section>
        <section name="advanced" title="Advanced" expanded="false">
            <param name="input_in_log_counts" type="boolean" label="Input in log Counts" truevalue="True" falsevalue="False" checked="false" help="set this to `TRUE` if counts are already log2-transformed
"/>
            <param name="return_mean_and_sd" type="boolean" label="Return Mean and SD" truevalue="True" falsevalue="False" checked="false" help="if TRUE, return Mean and Standard Deviation of groups in addition to DEG estimates for
contrast(s)
"/>
            <param name="voom_normalization_method" type="select" label="Normalization Method" help="Normalization method to be applied to the logCPM values when using `limma::voom`">
                <option value="none">none</option>
                <option value="scale">scale</option>
                <option value="quantile" selected="true">quantile</option>
                <option value="cyclicloess">cyclicloess</option>
                <option value="TMM">TMM</option>
                <option value="TMMwzp">TMMwzp</option>
                <option value="RLE">RLE</option>
                <option value="upperquartile">upperquartile</option>
            </param>
        </section>
        <section name="visualization" title="Visualization" expanded="false">
            <param name="save_plots" type="boolean" label="Save Plots" truevalue="True" falsevalue="False" checked="true" help="Whether to save plots to files during analysis (Defaults to `TRUE`, overwritable using option 'moo_save_plots' or environment variable 'MOO_SAVE_PLOTS')
"/>
        </section>
    </inputs>
    <outputs>
        <data name="params_json_debug" format="json" from_work_dir="galaxy_params.json" label="${tool.name} on ${on_string}: Raw Parameters"/>
        <data name="cleaned_params_debug" format="json" from_work_dir="cleaned_params.json" label="${tool.name} on ${on_string}: Cleaned Parameters"/>
        <data name="multiOmicDataSet" format="rds" from_work_dir="moo.rds" label="${tool.name} on ${on_string}: multiOmicDataSet"/>
        <collection name="figures" type="list" label="${tool.name} on ${on_string}: figures">
            <discover_datasets pattern="__name_and_ext__" directory="figures/diff/" recurse="true"/>
        </collection>
    </outputs>
    <help><![CDATA[

**Differential Counts Analysis**

Runs `MOSuite::diff_counts()` - https://ccbr.github.io/MOSuite/reference/diff_counts.html`

Differential expression analysis

**Outputs:**

- multiOmicDataSet: file (moo.rds)
- figures: directory (figures/diff/)

**Version info**

- Docker: nciccbr/mosuite:v0.2.1
- GitHub: CCBR/MOSuite-Galaxy @ `22b4161` - https://github.com/CCBR/MOSuite-Galaxy/tree/22b4161

]]></help>
    <citations>
        <citation type="doi">10.5281/zenodo.16371580</citation>
    </citations>
</tool>
